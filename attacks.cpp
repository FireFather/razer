#include "attacks.h"

attacks slider_attacks;

constexpr uint64_t bishop_masks[] =
{
	0x40201008040200, 0x402010080400, 0x4020100a00, 0x40221400, 0x2442800, 0x204085000, 0x20408102000, 0x2040810204000, 
	0x20100804020000, 0x40201008040000, 0x4020100a0000, 0x4022140000, 0x244280000, 0x20408500000, 0x2040810200000, 0x4081020400000, 
	0x10080402000200, 0x20100804000400, 0x4020100a000a00, 0x402214001400, 0x24428002800, 0x2040850005000, 0x4081020002000, 0x8102040004000, 
	0x8040200020400, 0x10080400040800, 0x20100a000a1000, 0x40221400142200, 0x2442800284400, 0x4085000500800, 0x8102000201000, 0x10204000402000, 
	0x4020002040800, 0x8040004081000, 0x100a000a102000, 0x22140014224000, 0x44280028440200, 0x8500050080400, 0x10200020100800, 0x20400040201000, 
	0x2000204081000, 0x4000408102000, 0xa000a10204000, 0x14001422400000, 0x28002844020000, 0x50005008040200, 0x20002010080400, 0x40004020100800, 
	0x20408102000, 0x40810204000, 0xa1020400000, 0x142240000000, 0x284402000000, 0x500804020000, 0x201008040200, 0x402010080400, 
	0x2040810204000, 0x4081020400000, 0xa102040000000, 0x14224000000000, 0x28440200000000, 0x50080402000000, 0x20100804020000, 0x40201008040200
};

constexpr uint64_t rook_masks[] =
{
	0x101010101017e, 0x202020202027c, 0x404040404047a, 0x8080808080876, 0x1010101010106e, 0x2020202020205e, 0x4040404040403e, 0x8080808080807e,
	0x1010101017e00, 0x2020202027c00, 0x4040404047a00, 0x8080808087600, 0x10101010106e00, 0x20202020205e00, 0x40404040403e00, 0x80808080807e00,
	0x10101017e0100, 0x20202027c0200, 0x40404047a0400, 0x8080808760800, 0x101010106e1000, 0x202020205e2000, 0x404040403e4000, 0x808080807e8000,
	0x101017e010100, 0x202027c020200, 0x404047a040400, 0x8080876080800, 0x1010106e101000, 0x2020205e202000, 0x4040403e404000, 0x8080807e808000,
	0x1017e01010100, 0x2027c02020200, 0x4047a04040400, 0x8087608080800, 0x10106e10101000, 0x20205e20202000, 0x40403e40404000, 0x80807e80808000,
	0x17e0101010100, 0x27c0202020200, 0x47a0404040400, 0x8760808080800, 0x106e1010101000, 0x205e2020202000, 0x403e4040404000, 0x807e8080808000,
	0x7e010101010100, 0x7c020202020200, 0x7a040404040400, 0x76080808080800, 0x6e101010101000, 0x5e202020202000, 0x3e404040404000, 0x7e808080808000,
	0x7e01010101010100, 0x7c02020202020200, 0x7a04040404040400, 0x7608080808080800, 0x6e10101010101000, 0x5e20202020202000, 0x3e40404040404000, 0x7e80808080808000
};

constexpr uint64_t bishop_magics[] =
{
	0x480a0088020080, 0x2003280620820000, 0x4180200c2020800, 0x104040480012000, 0x684042100802c00, 0x102080288200004, 0x84020350282401, 0x1108802090242004, 
	0x1010501190048480, 0xc000200200820080, 0x50141204040020a0, 0x4001040400800040, 0x800211040000041, 0x208110420042000, 0x90801442002, 0x8460a101109000, 
	0x99121020282080, 0x5402000810211220, 0x90000105002900, 0x40021240480a8, 0x802805400a00112, 0xe4420101a0900810, 0x18c800200b00834, 0x4013200144120800, 
	0x321000c2100200, 0x800802000810035d, 0x800b00008004641, 0x1018080084220020, 0x20840000802020, 0x5081020049004113, 0x2000840020842424, 0x83102000440400, 
	0x80c1010242040, 0x8089438021402, 0x80404044080203, 0x2200800038820, 0xc0136020820080, 0x80e040040880804, 0x61040080490800, 0xc10808a00810100, 
	0x804102c400a0a, 0x1102020222102000, 0x2031040202040100, 0xcc01c208008880, 0x2100aa020c000200, 0xc012104208208200, 0x80200454008000c0, 0x2a08180283802070, 
	0x40a0804060004, 0x9109444208212001, 0x82104064100800, 0x9240001a84240000, 0x800001002021214, 0x8002004c10202c0, 0x240080801105c01, 0x102204d4008016, 
	0x2040820050022810, 0x8040022880c7004, 0x10000100809000, 0x22040208808, 0x4804806420042402, 0x1490891900080, 0x8090b0111020a084, 0x40a00200a1010208
};

constexpr uint64_t rook_magics[] =
{
	0x90800080c0002012, 0x1880200110804000, 0x308028801000a000, 0x100100020042901, 0x200085032001460, 0x1200060018850410, 0x2200010084080200, 0x1200040104204282, 
	0x1800040018020, 0x80401000442000, 0x4021002003001044, 0x942000842001020, 0x141808008000400, 0x1000400130048, 0x4085000200010004, 0x8001000100004086, 
	0x3500208000804004, 0x610004020004000, 0x9004410020010410, 0xc200808008001001, 0x404010100080010, 0x2808044000600, 0x6080804a000300, 0x200008c2049, 
	0x20200c600250080, 0x8482a10300400880, 0x100c200080500080, 0x1003900100020, 0xc020012000d2008, 0x932003600041048, 0x1801050400080290, 0x485004c20000840b, 
	0x2c80c000800438, 0x11208a2002804000, 0x800600083801000, 0x200900a02002040, 0x100040080802800, 0x1192020080800400, 0x12000152000418, 0x280014904600050c, 
	0x2008c4000208000, 0x420412010044000, 0x8060004011030020, 0x800204052020008, 0x4002280100110014, 0x4000810020200, 0x2020004010100, 0x1148048406520005, 
	0x20100800042a300, 0x84852010400280, 0x600010008480, 0x5008080090008080, 0x2000080080040080, 0x400b0048ac000300, 0xc401000a00242300, 0x2500010954018e00, 
	0x4201008000412651, 0x801025004009, 0x401002001084411, 0x1b002098300045, 0x8001005002440801, 0x1008802040001, 0x280c100083180244, 0x600620810024024a
};

constexpr int bishop_offsets[] =
{
	0x0, 0x40, 0x60, 0x80, 0xa0, 0xc0, 0xe0, 0x100,
	0x140, 0x160, 0x180, 0x1a0, 0x1c0, 0x1e0, 0x200, 0x220,
	0x240, 0x260, 0x280, 0x300, 0x380, 0x400, 0x480, 0x4a0,
	0x4c0, 0x4e0, 0x500, 0x580, 0x780, 0x980, 0xa00, 0xa20,
	0xa40, 0xa60, 0xa80, 0xb00, 0xd00, 0xf00, 0xf80, 0xfa0,
	0xfc0, 0xfe0, 0x1000, 0x1080, 0x1100, 0x1180, 0x1200, 0x1220,
	0x1240, 0x1260, 0x1280, 0x12a0, 0x12c0, 0x12e0, 0x1300, 0x1320,
	0x1340, 0x1380, 0x13a0, 0x13c0, 0x13e0, 0x1400, 0x1420, 0x1440
};

constexpr int rook_offsets[] =
{
	0x0, 0x1000, 0x1800, 0x2000, 0x2800, 0x3000, 0x3800, 0x4000,
	0x5000, 0x5800, 0x5c00, 0x6000, 0x6400, 0x6800, 0x6c00, 0x7000,
	0x7800, 0x8000, 0x8400, 0x8800, 0x8c00, 0x9000, 0x9400, 0x9800,
	0xa000, 0xa800, 0xac00, 0xb000, 0xb400, 0xb800, 0xbc00, 0xc000,
	0xc800, 0xd000, 0xd400, 0xd800, 0xdc00, 0xe000, 0xe400, 0xe800,
	0xf000, 0xf800, 0xfc00, 0x10000, 0x10400, 0x10800, 0x10c00, 0x11000,
	0x11800, 0x12000, 0x12400, 0x12800, 0x12c00, 0x13000, 0x13400, 0x13800,
	0x14000, 0x15000, 0x15800, 0x16000, 0x16800, 0x17000, 0x17800, 0x18000
};

constexpr int bishop_shifts[] =
{
	0x6, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5, 0x6,
	0x5, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5,
	0x5, 0x5, 0x7, 0x7, 0x7, 0x7, 0x5, 0x5,
	0x5, 0x5, 0x7, 0x9, 0x9, 0x7, 0x5, 0x5,
	0x5, 0x5, 0x7, 0x9, 0x9, 0x7, 0x5, 0x5,
	0x5, 0x5, 0x7, 0x7, 0x7, 0x7, 0x5, 0x5,
	0x5, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5,
	0x6, 0x5, 0x5, 0x5, 0x5, 0x5, 0x5, 0x6
};

constexpr int rook_shifts[] =
{
	0xc, 0xb, 0xb, 0xb, 0xb, 0xb, 0xb, 0xc,
	0xb, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xb,
	0xb, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xb,
	0xb, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xb,
	0xb, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xb,
	0xb, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xb,
	0xb, 0xa, 0xa, 0xa, 0xa, 0xa, 0xa, 0xb,
	0xc, 0xb, 0xb, 0xb, 0xb, 0xb, 0xb, 0xc
};

void attacks::initialize()
{
	for (auto i = 0; i < squares; ++i)
	{
		rook_magics_[i] =
		{
			rook_masks[i], rook_magics[i], rook_shifts[i], rook_offsets[i]
		};

		bishop_magics_[i] =
		{
			bishop_masks[i], bishop_magics[i], bishop_shifts[i], bishop_offsets[i]
		};
	}
}
